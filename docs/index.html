<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Au Jour Le Jour</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <header class="topbar">
      <div class="brand">
        <div class="brand-mark">AJL</div>
        <div>
          <div class="brand-title">Au Jour Le Jour</div>
          <div class="brand-sub">Essentials tracker</div>
        </div>
      </div>

      <div class="month-nav">
        <button id="prev-month" class="icon-btn" aria-label="Previous month">&#x2039;</button>
        <input id="month-picker" class="month-input" type="month" />
        <button id="next-month" class="icon-btn" aria-label="Next month">&#x203A;</button>
      </div>

      <div class="top-actions">
        <label class="toggle">
          <input id="essentials-toggle" type="checkbox" checked />
          <span>Essentials only</span>
        </label>
        <nav class="mode-tabs">
          <button id="nav-today" class="tab-btn active">Today</button>
          <button id="nav-review" class="tab-btn">Review</button>
          <button id="nav-setup" class="tab-btn">Setup</button>
        </nav>
      </div>
    </header>

    <main class="container">
      <div id="system-banner" class="system-banner hidden"></div>
      <section id="today-view" class="view">
        <div id="zero-state" class="zero-state hidden">
          <div class="zero-card">
            <div class="zero-title">No bills yet.</div>
            <div class="zero-sub">Add essentials to generate your monthly list.</div>
            <button id="zero-templates-btn" class="primary-btn">Go to Setup</button>
          </div>
        </div>

        <div id="status-bar" class="status-bar">
          <div class="status-counts">
            <div class="status-count"><span id="count-remaining">0</span> Remaining</div>
            <div class="status-count overdue"><span id="count-overdue">0</span> Overdue</div>
            <div class="status-count soon"><span id="count-soon">0</span> Due soon</div>
          </div>
          <div id="status-period" class="status-period"></div>
          <button id="status-expand" class="ghost-btn">Summary</button>
        </div>

        <div id="summary-sheet" class="sheet hidden">
          <div class="sheet-card">
            <div class="sheet-header">
              <div>
                <div class="sheet-title">Monthly summary</div>
                <div class="sheet-sub">Reference totals only.</div>
              </div>
              <button id="summary-close" class="icon-btn" aria-label="Close">&times;</button>
            </div>
            <div class="summary-counts">
              <div>Remaining: <span id="summary-count-remaining">0</span></div>
              <div>Overdue: <span id="summary-count-overdue">0</span></div>
              <div>Due soon: <span id="summary-count-soon">0</span></div>
              <div>Done: <span id="summary-count-done">0</span></div>
            </div>
            <div class="summary-grid">
              <div class="summary-item">
                <div class="summary-label">Required</div>
                <div id="required-amount" class="summary-value">$0.00</div>
              </div>
              <div class="summary-item">
                <div class="summary-label">Done</div>
                <div id="paid-amount" class="summary-value">$0.00</div>
              </div>
              <div class="summary-item">
                <div class="summary-label">Remaining</div>
                <div id="remaining-amount" class="summary-value">$0.00</div>
              </div>
              <div class="summary-item">
                <div class="summary-label">Plan pace (day)</div>
                <div id="need-day" class="summary-value">$0.00</div>
                <div id="need-day-plan" class="summary-caption">Planning avg: $0.00/day</div>
              </div>
              <div class="summary-item">
                <div class="summary-label">Plan pace (week)</div>
                <div id="need-week" class="summary-value">$0.00</div>
                <div id="need-week-plan" class="summary-caption">Planning avg: $0.00/week</div>
              </div>
            </div>
          </div>
        </div>

        <section class="card action-queue" id="action-queue">
          <div class="queue-header">
            <div>
              <div class="queue-title">Action Queue</div>
              <div id="queue-subtitle" class="queue-sub">Overdue: 0 items</div>
            </div>
            <button id="mark-all-overdue" class="btn-small btn-primary">Mark all overdue done</button>
          </div>

          <div class="queue-section">
            <div class="queue-section-title">Overdue</div>
            <div id="queue-overdue" class="queue-list"></div>
          </div>
          <div class="queue-section">
            <div class="queue-section-title">Due next 7 days</div>
            <div id="queue-soon" class="queue-list"></div>
          </div>
          <div class="queue-section">
            <div class="queue-section-title">
              <span>Later</span>
              <button id="toggle-later" class="ghost-btn small">Hide</button>
            </div>
            <div id="queue-later" class="queue-list"></div>
          </div>
        </section>

        <section id="recent-strip" class="recent-strip hidden"></section>

        <section id="items-card" class="card all-items">
          <div class="card-title">Bills list</div>
          <div class="filter-bar">
            <input id="search-input" class="search-input" type="search" placeholder="Search bills..." />
            <div class="chip-group" id="status-chips">
              <button class="chip active" data-status="all">All</button>
              <button class="chip" data-status="pending">Pending</button>
              <button class="chip" data-status="partial">Partial</button>
              <button class="chip" data-status="paid">Done</button>
              <button class="chip" data-status="skipped">Skipped</button>
            </div>
            <select id="category-filter" class="select">
              <option value="all">All categories</option>
            </select>
            <select id="sort-filter" class="select">
              <option value="due_date">Due date</option>
              <option value="amount">Amount</option>
              <option value="name">Name</option>
              <option value="status">Status</option>
            </select>
          </div>
          <div id="items-list" class="items-list"></div>
        </section>
      </section>

      <section id="review-view" class="view hidden">
        <div class="page-title">Review</div>
        <div class="page-sub">Activity and trends for this month.</div>
        <div class="review-filters">
          <button class="chip" data-review-range="today">Today</button>
          <button class="chip" data-review-range="week">7d</button>
          <button class="chip active" data-review-range="month">Month</button>
        </div>
        <div id="review-activity" class="card">
          <div class="card-title">Activity Log</div>
          <div id="review-activity-list" class="list"></div>
        </div>
        <div id="review-card" class="card">
          <div class="card-title">Month review</div>
          <div id="review-summary" class="review-grid"></div>
          <div id="review-list" class="list"></div>
        </div>
      </section>

      <section id="setup-view" class="view hidden">
        <div class="page-title">Setup</div>
        <div class="page-sub">Templates, categories, backups, and reserved buckets.</div>
        <div class="disclaimer">This app tracks bills. You pay outside the app.</div>

        <section class="setup-block">
          <div class="block-title">Defaults</div>
          <div class="block-sub">Period view, sort order, and due-soon window.</div>
          <div class="defaults-grid">
            <label>
              Default period
              <select id="defaults-period" class="select">
                <option value="month">Month</option>
              </select>
            </label>
            <label>
              Default sort
              <select id="defaults-sort" class="select">
                <option value="due_date">Due date</option>
                <option value="amount">Amount</option>
                <option value="name">Name</option>
                <option value="status">Status</option>
              </select>
            </label>
            <label>
              Due soon window (days)
              <input id="defaults-due-soon" type="number" min="1" max="31" />
            </label>
            <button id="save-defaults" class="ghost-btn">Save defaults</button>
          </div>
        </section>

        <section class="setup-block">
          <div class="block-title">Categories</div>
          <div class="block-sub">Manage categories used for filtering.</div>
          <div class="categories-row">
            <input id="category-input" type="text" placeholder="Add category" />
            <button id="category-add" class="ghost-btn">Add</button>
          </div>
          <div id="categories-list" class="categories-list"></div>
        </section>

        <section class="setup-block">
          <div class="block-header">
            <div>
              <div class="block-title">Recurring bills</div>
              <div class="block-sub">These generate your monthly checklist.</div>
            </div>
            <button id="open-backup" class="ghost-btn">Backup / Export</button>
          </div>
          <form id="template-form" class="template-form">
            <input id="template-name" type="text" placeholder="Name" required />
            <input id="template-category" type="text" placeholder="Category" />
            <input id="template-amount" type="number" min="0" step="0.01" placeholder="Amount" required />
            <input id="template-due-day" type="number" min="1" max="31" placeholder="Due day" required />
            <label class="toggle small">
              <input id="template-essential" type="checkbox" checked />
              <span>Essential</span>
            </label>
            <label class="toggle small">
              <input id="template-active" type="checkbox" checked />
              <span>Active</span>
            </label>
            <input id="template-note" type="text" placeholder="Default note" />
            <input id="template-match-key" type="text" placeholder="Match key" />
            <input id="template-match-tolerance" type="number" min="0" step="0.01" placeholder="Match tolerance" />
            <button class="primary-btn" type="submit">Add bill</button>
          </form>
          <div id="template-error" class="form-error hidden"></div>

          <div class="template-actions">
            <label class="toggle small">
              <input id="select-all-templates" type="checkbox" />
              <span>Select all</span>
            </label>
            <button id="archive-selected" class="ghost-btn" disabled>Archive selected</button>
            <button id="delete-selected" class="ghost-btn" disabled>Delete selected</button>
            <button id="apply-templates" class="ghost-btn">Apply template updates to this month</button>
          </div>

          <div id="templates-list" class="templates-list"></div>
        </section>

        <section id="funds-section" class="setup-block">
          <div class="block-title">Reserved buckets</div>
          <div class="block-sub">Sinking funds for yearly or quarterly obligations.</div>

          <form id="fund-form" class="template-form">
            <input id="fund-name" type="text" placeholder="Name" required />
            <input id="fund-category" type="text" placeholder="Category" />
            <input id="fund-target" type="number" min="0" step="0.01" placeholder="Target amount" required />
            <input id="fund-due-date" type="date" required />
            <select id="fund-cadence" class="select">
              <option value="yearly">Yearly</option>
              <option value="quarterly">Quarterly</option>
              <option value="custom_months">Custom months</option>
            </select>
            <input id="fund-months" type="number" min="1" step="1" placeholder="Months per cycle" />
            <label class="toggle small">
              <input id="fund-essential" type="checkbox" checked />
              <span>Essential</span>
            </label>
            <label class="toggle small">
              <input id="fund-auto" type="checkbox" checked />
              <span>Auto contribute</span>
            </label>
            <label class="toggle small">
              <input id="fund-active" type="checkbox" checked />
              <span>Active</span>
            </label>
            <button class="primary-btn" type="submit">Add bucket</button>
          </form>
          <div id="fund-error" class="form-error hidden"></div>
          <div id="funds-list" class="templates-list"></div>
        </section>

        <section class="setup-block">
          <div class="block-title">Data safety</div>
          <div class="block-sub">Reset local data or start in safe mode if something breaks.</div>
          <div class="safety-actions">
            <button id="reset-local-inline" class="ghost-btn danger">Reset local data</button>
            <button id="start-safe-mode" class="ghost-btn">Start in safe mode</button>
          </div>
        </section>
      </section>
    </main>

    <div id="backup-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <div>
            <div class="modal-title">Backup & Export</div>
            <div class="modal-sub">Keeps your data portable across computers.</div>
          </div>
          <button id="close-backup" class="icon-btn" aria-label="Close">&times;</button>
        </div>
        <div class="modal-actions">
          <button id="export-month" class="primary-btn">Export month CSV</button>
          <button id="export-backup" class="ghost-btn">Export full backup (JSON)</button>
          <label class="ghost-btn file-input">
            Import backup (JSON)
            <input id="import-backup" type="file" accept="application/json" />
          </label>
          <button id="reset-local" class="ghost-btn danger">Reset local data</button>
        </div>
        <div class="modal-footer-hint">Saved in this browser. To move devices: Export JSON â†’ Import on the new device.</div>
      </div>
    </div>

    <div id="details-drawer" class="drawer hidden">
      <div class="drawer-scrim" data-close="details"></div>
      <div class="drawer-panel">
        <div class="drawer-header">
          <div>
            <div id="detail-name" class="drawer-title">Bill</div>
            <div id="detail-meta" class="drawer-sub">Due</div>
          </div>
          <button class="icon-btn" data-close="details" aria-label="Close">&times;</button>
        </div>
        <div class="drawer-body">
          <div class="drawer-actions">
            <button id="detail-mark-done" class="btn-primary">Mark done</button>
            <button id="detail-skip" class="ghost-btn">Mark skipped</button>
          </div>
          <div class="drawer-section">
            <div class="section-title">Log update</div>
            <div class="log-update-row">
              <input id="detail-log-amount" type="number" min="0" step="0.01" placeholder="Amount completed" />
              <button id="detail-log-submit" class="btn-small btn-primary">Log update</button>
            </div>
            <div id="detail-log-status" class="meta"></div>
          </div>
          <div class="drawer-section">
            <div class="section-title">Edit bill</div>
            <div class="drawer-grid">
              <label>
                Name
                <input id="detail-edit-name" type="text" />
              </label>
              <label>
                Category
                <input id="detail-edit-category" type="text" />
              </label>
              <label>
                Amount
                <input id="detail-edit-amount" type="number" min="0" step="0.01" />
              </label>
              <label>
                Due date
                <input id="detail-edit-due" type="date" />
              </label>
            </div>
            <label>
              Notes
              <textarea id="detail-edit-note" rows="3"></textarea>
            </label>
            <button id="detail-save" class="btn-small">Save changes</button>
            <div id="detail-save-status" class="meta"></div>
          </div>
          <div class="drawer-section">
            <div class="section-title">Activity</div>
            <div id="detail-history" class="list"></div>
          </div>
        </div>
      </div>
    </div>

    <div id="toast" class="toast hidden">
      <div id="toast-message" class="toast-message"></div>
      <button id="toast-action" class="toast-action hidden">Undo</button>
    </div>

    <script src="./web-adapter.js"></script>
    <script src="./app.js"></script>
  </body>
</html>
